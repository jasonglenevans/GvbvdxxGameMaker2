window.audioEngine={sfx:{audio:null,play:function(t){this.audio=document.createElement("audio"),this.audio.src=t,this.audio.play()}},bgm:{audio:document.createElement("audio"),isPlaying:!1,play:function(){try{this.audio.play(),this.isPlaying=!0}catch(t){console.warn("[AudioEngine]:error ignored"+t)}},setSrc:function(t){this.audio.src=t}},stop:function(){try{this.sfx.audio&&(this.sfx.audio.pause(),this.sfx.audio=null),this.bgm.isPlaying=!1}catch(t){console.warn("[AudioEngine]:error ignored"+t)}},tickAudio:function(){1==window.audioEngine.bgm.isPlaying?window.audioEngine.bgm.audio.play():window.audioEngine.bgm.audio.pause()}},window.audioEngine.bgm.audio.loop=!0,setInterval(window.audioEngine.tickAudio,1),window.vm={idcounter:0,control:{start:function(a){if(!vm.audioEngine)throw Error("AudioEngine Must Be Attached");if(!vm.renderer)throw Error("Renderer Must Be Attached");vm.control.stop(),vm.control.running=!0,vm.idcounter=0,vm.project.monitors=[],window.vm.renderer.bg.src="";try{eval(vm.code)}catch(e){vm.console.error("Error in script:"+e)}},stop:function(){vm.idcounter=0,vm.control.running=!1,vm.project.sprites=[],vm.project.events.tick=[],vm.project.sprites=[],vm.project.keysPressed=[],vm.audioEngine.stop();try{window.vm.onstop()}catch(t){console.error(t)}},running:!1},code:"",renderer:null,attachRenderer:function(t){return vm.renderer=t,vm.renderer.start(),t},attachAudioEngine:function(t){return vm.audioEngine=t},project:{mouseDown:!1,mouseX:0,mouseY:0,keysPressed:[],sprites:[],events:{tick:[]},monitors:[],resources:[],block:{moveSteps:function(t,e){try{var r=e,o=90-t.direction,n=Math.cos(o*(Math.PI/180))*r,r=Math.sin(o*(Math.PI/180))*r,n=n+n;t.x=t.x+n,t.y=t.y+(r+r)}catch(t){vm.console.error("Error in script:"+t)}},deleteList:function(t,e){try{delete t[e];for(var r=0,o=[];t.length>r;)null!=t[r]&&o.push(t[r]),r+=1;return o}catch(t){vm.console.error("Error in script:"+t)}},makeSprite:function(){try{vm.idcounter+=1;var t={direction:90,x:0,y:0,width:32,height:32,image:null,flip:"none",id:vm.idcounter,ghost:0,clicked:[]};return this.showSprite(t),t}catch(t){}},makeMonitor:function(){try{var t={x:0,y:0,value:0,name:"monitor",visible:!0,clicked:[]};return window.vm.project.monitors.push(t),t}catch(t){vm.console.error("Error in script:"+t)}},showSprite:function(t){try{this.hideSprite(t),vm.project.sprites.push(t)}catch(t){vm.console.error("Error in script:"+t)}},hideSprite:function(t){try{var e=vm.project.sprites.indexOf(t);-1<e&&vm.project.sprites.splice(e,1)}catch(t){}},cos:function(t){try{return Math.cos(t*(Math.PI/180))}catch(t){vm.console.error(t)}},sin:function(t){try{return Math.sin(t*(Math.PI/180))}catch(t){vm.console.error(t)}},getMoseData:function(){try{return{x:vm.project.mouseX,y:vm.project.mouseY,down:vm.project.mouseDown}}catch(t){}},dataToImg:function(t){try{var e=document.createElement("img");return e.src=t,e.setAttribute("style","image-rendering: pixelated;"),e}catch(t){}},random:function(t,e){var r;return e<t&&(r=t,t=e,e=r),Math.floor(Math.random()*(e-t+1)+t)},isTouching:function(t,e,r){try{return vm.___CHECKCOLLIDE(t,e)}catch(t){vm.console.error("Error in script:"+t)}},getKeyPressed:function(t){try{return!!vm.project.keysPressed[t]}catch(t){}},wait:function(t,e){try{setTimeout(()=>{window.vm.control.running&&e()},1e3*t)}catch(t){}},getTouchMouse:function(t){return window.vm.___CHECKCOLLIDE({x:window.vm.project.mouseX,y:window.vm.project.mouseY,width:1,height:1},t)}}},variables:{canDrag:!1},vmTick:function(){if(vm.control.running){for(var t in vm.project.events.tick)try{vm.project.events.tick[t]()}catch(t){vm.console.error(t)}try{vm.renderer.tick(vm.project.sprites,vm.project.monitors)}catch(t){}this.ticks+=0;try{window.vm.ontick()}catch(t){console.error(t)}}else this.ticks=0;window.requestAnimationFrame(vm.vmTick)},start:function(){vm.control.start()},stop:function(){vm.control.stop()},setMousePos:function(t){this.project.mouseX=t.x,this.project.mouseY=t.y},setMouseDown:function(t){if(1==t)for(var e in vm.project.sprites)try{if(this.___CHECKCOLLIDE({x:this.project.mouseX,y:this.project.mouseY,width:1,height:1},vm.project.sprites[e])){var r,o=vm.project.sprites[e];for(r in o.clicked)try{o.clicked[r]()}catch(t){vm.console.error(t)}}}catch(t){console.error(t)}this.project.mouseDown=t},console:{log:function(t){console.log("[vm - program]: "+t)},error:function(t){console.error("[vm - program]: "+t),vm.stop()},clear:function(t){console.clear()}},simulateKey:function(t){t.down?this.project.keysPressed[t.key]=!0:this.project.keysPressed[t.key]=!1},collideWidth:0,collideHeight:0,___CHECKCOLLIDE:function(t,e){return!1},collideDiv:document.createElement("div"),addEventListener:function(t,e){this["on"+t]=e},ontick:function(){},onspritecreate:function(t){},onstop:function(){},__decodeDataBase64URI:function(t){return atob(t.split(";").pop().split(",").pop())}},vm.___CHECKCOLLIDE=function(t,e){var r=+t.width,o=t.height,n=t.x-vm.renderer.canvas.width/2,i=t.y-vm.renderer.canvas.height/2,c=+e.width,s=e.height,t=e.x-vm.renderer.canvas.width/2,e=e.y-vm.renderer.canvas.height/2;return!(i+o<e||e+s<i||2*n+r<2*t||2*t+c<2*n)},window.requestAnimationFrame(vm.vmTick),window.renderer={canvas:null,bg:document.createElement("img"),backgroundImg:null,start:function(){this.context=this.canvas.getContext("2d"),this.context.globalAlpha=1,this.context.strokeStyle=this.color,this.context.fillStyle=this.color,this.context.beginPath(),this.context.fillRect(0,0,this.canvas.width+2,this.canvas.height+2),this.context.stroke(),this.test=0,this.canvas.style.imageRendering="Pixelated"},tick:function(t,e){this.context.globalAlpha=1,this.context.fillStyle=this.color,this.context.strokeStyle=this.color,this.context.beginPath(),this.context.fillRect(0,0,this.canvas.width+2,this.canvas.height+2),this.context.stroke(),this.context.webkitImageSmoothingEnabled=!1,this.context.mozImageSmoothingEnabled=!1,this.context.imageSmoothingEnabled=!1;try{this.context.drawImage(this.bg,0,0,this.canvas.width,this.canvas.height)}catch(t){}for(var r in t)t[r],this._drawSprite(t[r]);for(var r in e)e[r],this._drawMonitor(e[r])},_drawSprite:function(t){this.context.save();try{var e=t.x,r=0-t.y,o=t.ghost;100<o&&(o=100),o<0&&(o=0),this.context.globalAlpha=1-o/100,this.context.translate(this.canvas.width/2+t.x+e,this.canvas.height/2+r),this.context.rotate((t.direction-90)*Math.PI/180),"hor"==t.flip?this.context.scale(-1,1):"ver"==t.flip&&this.context.scale(1,-1),this.context.drawImage(t.image,t.width/-2,t.height/-2,t.width,t.height)}catch(t){}this.context.restore()},_drawMonitor:function(t){this.context.save();try{if(t.visible){this.context.globalAlpha=1,this.context.translate(0,0),renderer.context.font="15px arial";var e=renderer.context.measureText(t.value).width,r=renderer.context.measureText(t.name).width-25;return this.context.globalAlpha=1,renderer.context.fillStyle="#868e96",renderer.context.fillRect(t.x-2,t.y-2,74+r+e,24),renderer.context.fillStyle="#ced4da",renderer.context.fillRect(t.x,t.y,70+r+e,20),renderer.context.fillStyle="#ff8c00",renderer.context.fillRect(t.x+60,t.y+3,5+r+e,15),renderer.context.fillStyle="white",renderer.context.fillText(t.value,t.x+60,t.y+15),renderer.context.fillStyle="black",renderer.context.fillText(t.name,t.x+6,t.y+15),{width:74+r+e,height:24,x:t.x,y:t.y}}}catch(t){console.error(t)}this.context.restore()},color:"#ffffff"},window.variables={vm:window.vm};